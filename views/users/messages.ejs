<% layout('layouts/boilerplate') %>

<div class="container my-4">
  <div class="row">
    <!-- Conversations List -->
    <div class="col-md-4">
      <div class="messages-sidebar">
        <h4 class="mb-3">Messages</h4>
        <div class="conversations-list">
          <div class="conversation-item active">
            <img src="/images/default-avatar.jpg" alt="User" class="conversation-avatar">
            <div class="conversation-info">
              <h6>John Doe</h6>
              <p class="conversation-preview">Thanks for the quick response...</p>
              <small class="conversation-time">2 min ago</small>
            </div>
            <span class="unread-badge">2</span>
          </div>
          
          <div class="conversation-item">
            <img src="/images/default-avatar.jpg" alt="User" class="conversation-avatar">
            <div class="conversation-info">
              <h6>Sarah Wilson</h6>
              <p class="conversation-preview">Is the property still available?</p>
              <small class="conversation-time">1 hour ago</small>
            </div>
          </div>
          
          <div class="conversation-item">
            <img src="/images/default-avatar.jpg" alt="User" class="conversation-avatar">
            <div class="conversation-info">
              <h6>Mike Johnson</h6>
              <p class="conversation-preview">Great place! Thank you for hosting</p>
              <small class="conversation-time">Yesterday</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Chat Area -->
    <div class="col-md-8">
      <div class="chat-container">
        <div class="chat-header">
          <div class="chat-user-info">
            <img src="/images/default-avatar.jpg" alt="User" class="chat-avatar">
            <div>
              <h6>John Doe</h6>
              <small class="text-muted">Active now</small>
            </div>
          </div>
          <div class="chat-actions">
            <button class="btn btn-outline-secondary btn-sm">
              <i class="fas fa-phone"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm">
              <i class="fas fa-video"></i>
            </button>
          </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
          <div class="message received">
            <img src="/images/default-avatar.jpg" alt="User" class="message-avatar">
            <div class="message-content">
              <p>Hi! I'm interested in booking your property for next weekend. Is it available?</p>
              <small class="message-time">10:30 AM</small>
            </div>
          </div>
          
          <div class="message sent">
            <div class="message-content">
              <p>Hello! Yes, it's available for next weekend. I'd be happy to host you!</p>
              <small class="message-time">10:32 AM</small>
            </div>
          </div>
          
          <div class="message received">
            <img src="/images/default-avatar.jpg" alt="User" class="message-avatar">
            <div class="message-content">
              <p>Perfect! What's the check-in process like?</p>
              <small class="message-time">10:35 AM</small>
            </div>
          </div>
          
          <div class="message sent">
            <div class="message-content">
              <p>Check-in is at 3 PM. I'll send you the access code and detailed instructions before your arrival.</p>
              <small class="message-time">10:37 AM</small>
            </div>
          </div>
        </div>
        
        <div class="chat-input">
          <form class="message-form">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Type a message..." id="messageInput">
              <button class="btn btn-primary" type="submit">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.messages-sidebar {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  height: 600px;
  overflow-y: auto;
}

.conversations-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.conversation-item {
  display: flex;
  align-items: center;
  padding: 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
  position: relative;
}

.conversation-item:hover,
.conversation-item.active {
  background: #f8f9fa;
}

.conversation-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 1rem;
}

.conversation-info {
  flex: 1;
}

.conversation-info h6 {
  margin: 0;
  font-weight: 600;
}

.conversation-preview {
  margin: 0.25rem 0 0 0;
  color: #666;
  font-size: 0.9rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.conversation-time {
  color: #999;
  font-size: 0.8rem;
}

.unread-badge {
  background: #ff385c;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: 600;
}

.chat-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  height: 600px;
  display: flex;
  flex-direction: column;
}

.chat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #eee;
}

.chat-user-info {
  display: flex;
  align-items: center;
}

.chat-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 0.75rem;
}

.chat-user-info h6 {
  margin: 0;
  font-weight: 600;
}

.chat-actions {
  display: flex;
  gap: 0.5rem;
}

.chat-messages {
  flex: 1;
  padding: 1rem 1.5rem;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.message {
  display: flex;
  align-items: flex-end;
  gap: 0.5rem;
}

.message.sent {
  justify-content: flex-end;
}

.message.sent .message-content {
  background: #ff385c;
  color: white;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
}

.message-content {
  background: #f1f3f4;
  padding: 0.75rem 1rem;
  border-radius: 18px;
  max-width: 70%;
}

.message-content p {
  margin: 0;
  font-size: 0.95rem;
}

.message-time {
  display: block;
  margin-top: 0.25rem;
  opacity: 0.7;
  font-size: 0.8rem;
}

.chat-input {
  padding: 1rem 1.5rem;
  border-top: 1px solid #eee;
}

.message-form .input-group {
  border-radius: 25px;
  overflow: hidden;
}

.message-form .form-control {
  border: 1px solid #ddd;
  border-right: none;
  padding: 0.75rem 1rem;
}

.message-form .btn {
  border-radius: 0;
  padding: 0.75rem 1rem;
}

@media (max-width: 768px) {
  .conversation-preview {
    max-width: 150px;
  }
  
  .message-content {
    max-width: 85%;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const messageForm = document.querySelector('.message-form');
  const messageInput = document.getElementById('messageInput');
  const chatMessages = document.getElementById('chatMessages');
  
  // Handle message sending
  messageForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const messageText = messageInput.value.trim();
    if (!messageText) return;
    
    // Create new message element
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message sent';
    messageDiv.innerHTML = `
      <div class="message-content">
        <p>${messageText}</p>
        <small class="message-time">Just now</small>
      </div>
    `;
    
    // Add to chat
    chatMessages.appendChild(messageDiv);
    
    // Clear input
    messageInput.value = '';
    
    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Simulate response (in real app, this would be real-time)
    setTimeout(() => {
      const responseDiv = document.createElement('div');
      responseDiv.className = 'message received';
      responseDiv.innerHTML = `
        <img src="/images/default-avatar.jpg" alt="User" class="message-avatar">
        <div class="message-content">
          <p>Thanks for your message! I'll get back to you soon.</p>
          <small class="message-time">Just now</small>
        </div>
      `;
      chatMessages.appendChild(responseDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1000);
  });
  
  // Handle conversation switching
  document.querySelectorAll('.conversation-item').forEach(item => {
    item.addEventListener('click', function() {
      document.querySelectorAll('.conversation-item').forEach(i => i.classList.remove('active'));
      this.classList.add('active');
      
      // Remove unread badge
      const badge = this.querySelector('.unread-badge');
      if (badge) badge.remove();
    });
  });
});
</script>